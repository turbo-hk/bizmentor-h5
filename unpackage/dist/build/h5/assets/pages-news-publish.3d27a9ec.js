import{O as e,K as t,o as s,c as a,w as i,a as l,d as n,t as o,k as u,u as h,F as c,P as d,Q as r,f as m,m as p,R as g,S as f,T as y,n as _,U as w,V as x,W as v}from"./index.5c7ed4f2.js";import{U as L}from"./utils.e3e4687e.js";import{_ as b}from"./plugin-vue_export-helper.21dcd24c.js";var k=b({name:"newsPublish",components:{choose:b({name:"image-choose",props:{imgList:{type:Array,default:function(){return[]}},quality:{type:Number,default:1},count:{type:Number,default:5},changes:{type:Function,default:null}},data:()=>({}),watch:{},methods:{chooseImg(){var s=this.count-this.imgList.length;e({count:s,success:e=>{var s=(e.tempFilePaths||[]).length+this.imgList.length,a=this.imgList;if(s<=this.count)a=this.imgList.concat(e.tempFilePaths),this.$emit("changes",a);else{for(var i=this.count-this.imgList.length,l=0;l<i;l++)a.push(e.tempFilePaths[l]);this.$emit("changes",a),t({title:"最多只能添加"+this.count+"张图片",icon:"none"})}}})},close(e){var t=this.imgList;t.splice(e,1),this.$emit("changes",t)},setCapital(e,t){var s=this.imgList;s[0]=s.splice(e,1,s[0])[0],this.$emit("changes",s)}}},[["render",function(e,t,g,f,y,_){const w=m,x=p;return s(),a(w,null,{default:i((()=>[l(w,{class:"feedback-body feedback-uploader"},{default:i((()=>[l(w,{class:"uni-uploader"},{default:i((()=>[l(w,{class:"uni-uploader-head",style:{"text-align":"right"}},{default:i((()=>[l(w,{class:""}),l(w,{class:"uni-uploader-info"},{default:i((()=>[n(o(g.imgList.length)+"/"+o(g.count),1)])),_:1})])),_:1}),l(w,{class:"uni-uploader-body"},{default:i((()=>[l(w,{class:"uni-uploader__files"},{default:i((()=>[(s(!0),u(c,null,h(g.imgList,((e,t)=>(s(),a(w,{key:t,class:"uni-uploader__file",style:{position:"relative"}},{default:i((()=>[l(x,{mode:"aspectFill",class:"uni-uploader__img",src:e},null,8,["src"]),t?(s(),a(w,{key:0,class:"set-capital",style:{background:"#0A98D5"},onClick:e=>_.setCapital(t)},{default:i((()=>[n("设为主图")])),_:2},1032,["onClick"])):(s(),a(w,{key:1,class:"set-capital"},{default:i((()=>[n("主图")])),_:1})),l(w,{class:"close-view",onClick:e=>_.close(t)},{default:i((()=>[n("x")])),_:2},1032,["onClick"])])),_:2},1024)))),128)),d(l(w,{class:"uni-uploader__input-box"},{default:i((()=>[l(w,{class:"uni-uploader__input",onClick:_.chooseImg},null,8,["onClick"])])),_:1},512),[[r,g.imgList.length<g.count]])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-0a37a85a"]]),compress:b({name:"image-compress",props:{quality:{type:Number,default:1},maxwh:{type:Number,default:1920},changes:{type:Function,default:null}},data(){return{imageW:this.maxwh,imageH:this.maxwh,redio:1}},methods:{yasuo(e){return new Promise(((t,s)=>{g({src:e,success:e=>{var s=parseFloat(e.width/e.height),a=e.width,i=e.height,l=this.maxwh;(a>l||i>l)&&(a>i?(a=l,i=parseInt(a/s)):(i=l,a=parseInt(i*s))),this.imageW=a,this.imageH=i;var n=f("myCanvas",this);n.drawImage(e.path,0,0,a,i),n.draw(!0,(s=>{var l=e.path.replace(/^.+\./,"");l="png"==l?"png":"jpg",y({x:0,y:0,width:a,height:i,destWidth:a,destHeight:i,quality:this.quality,canvasId:"myCanvas",fileType:l,success:s=>{s.oldWidth=e.width,s.oldHeight=e.height,s.width=a,s.height=i,s.path=e.path,s.fileType=l,t(s)}},this)}))}})}))},yasuoImg(e,t){t=t||[],e=e;return new Promise(((s,a)=>{"object"==typeof e?e.length?this.yasuo(e[0]).then((a=>{t.push(a);for(var i=[],l=0;l<e.length;l++)0!=l&&i.push(e[l]);this.yasuoImg(i,t).then((e=>{s(e)}))})):(s(t),this.$emit("changes",t)):this.yasuoImg(e).then((e=>{s(t),this.$emit("changes",t)}))}))}}},[["render",function(e,t,n,o,u,h){const c=w,d=m;return s(),a(d,null,{default:i((()=>[l(d,{style:{position:"fixed",top:"9999px"}},{default:i((()=>[l(c,{style:_("width:"+u.imageW+"px;height:"+u.imageH+"px;"),"canvas-id":"myCanvas"},null,8,["style"])])),_:1})])),_:1})}]])},data:()=>({count:6,imgList:[],maxwh:280,quality:1,sendDate:{score:0,content:"",contact:""}}),onLoad(){L.hasLogin()||L.toLogin()},methods:{fileChange(e){this.imgList=e}}},[["render",function(e,t,n,o,u,h){const c=x,d=v("choose"),r=v("compress"),p=m;return s(),a(p,{class:"page"},{default:i((()=>[l(p,{class:"feedback-body"},{default:i((()=>[l(c,{placeholder:"请输入摘要...",style:{"border-bottom":"1px solid   #F1F1F3"},modelValue:u.sendDate.content,"onUpdate:modelValue":t[0]||(t[0]=e=>u.sendDate.content=e),class:"feedback-textare"},null,8,["modelValue"]),l(d,{count:u.count,imgList:u.imgList,onChanges:h.fileChange},null,8,["count","imgList","onChanges"]),l(r,{ref:"compress",maxwh:u.maxwh,quality:u.quality},null,8,["maxwh","quality"])])),_:1})])),_:1})}],["__scopeId","data-v-363e57e2"]]);export{k as default};
